const questions = [
            {
        "question": "A nurse is caring for multiple clients on a medical-surgical unit. Which client should the nurse prioritize for immediate assessment and intervention?",
        "options": {
            "A": "A client with a ventriculoperitoneal (VP) shunt placed 8 hours ago who is now vomiting.",
            "B": "A client who underwent cardiac catheterization 2 days ago and has palpable distal pulses.",
            "C": "A client with an IV antibiotic infusion who reports mild nausea but no other symptoms.",
            "D": "A client post-appendectomy 24 hours ago who is requesting pain medication."
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 3
    },
    {
        "question": "A nurse is caring for multiple patients with infectious diseases. For which of the following conditions is Standard Precautions alone sufficient for infection control?(Select all that apply.)",
        "options": {
            "A": "Hepatitis B",
            "B": "Cryptococcus meningitis",
            "C": "HIV/AIDS",
            "D": "Methicillin-resistant Staphylococcus aureus (MRSA) wound infection",
            "E": "Clostridium difficile infection"
        },
        "correctAnswer": [
            "A",
            "B",
            "C"
        ],
        "explanation": "  ",
        "difficulty": 4
    },
    {
        "question": " A nurse is educating a client about nitrofurantoin for the treatment of a urinary tract infection. Which statement by the client requires immediate follow-up?",
        "options": {
            "A": "I will immediately report the red-orange urine to the healthcare provider.",
            "B": "I will crush the tablets if I have difficulty swallowing them.",
            "C": "I will stop taking the medication if my symptoms improve after a few doses.",
            "D": "I don’t need to drink extra water while taking this medication."
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 3
    },
    {
        "question": " The nurse is caring for a client who has pulmonary tuberculosis (TB). Which infection control measure should the nurse implement?",
        "options": {
            "A": "Restrict visitors who are pregnant.",
            "B": "Remove any portable fans in the room.",
            "C": "Wear a dosimeter badge during client care.",
            "D": "Place the client further away from the nursing station."
        },
        "correctAnswer": "B",
        "explanation": "    ",
        "difficulty": 2
    },
    {
        "question": "The nurse is caring for a group of premature infants. Which action is most important in preventing healthcare-acquired infection?",
        "options": {
            "A": "Performing frequent hand hygiene.",
            "B": "Disinfecting commonly touched surfaces.",
            "C": "Screening visitors for illness.",
            "D": "Administer prophylactic antibiotics."
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 1
    },
    {
        "question": "A nurse is caring for a client with Herpes Zoster Ophthalmicus. Which infection control measure should the nurse implement?",
        "options": {
            "A": "Place the client under airborne precautions until lesions resolve.",
            "B": "Apply contact precautions until the lesions have crusted over.",
            "C": "Restrict the client to the room at all times for 30 days.",
            "D": "Wear a surgical mask only when irrigating the client’s affected eye."
        },
        "correctAnswer": "B",
        "explanation": "    ",
        "difficulty": 3
    },
    {
        "question": "A 22-year-old client with measles must be transported to radiology. Which action best reduces the risk of transmission?",
        "options": {
            "A": "Place a surgical mask on the client but rely on standard precautions for yourself.",
            "B": "Have both the client and yourself wear surgical masks.",
            "C": "Place a surgical mask on the client and wear an N95 respirator yourself.",
            "D": "Postpone the procedure until the measles rash completely resolves."
        },
        "correctAnswer": "C",
        "explanation": "    ",
        "difficulty": 2
    },
    {
        "question": "The infection control nurse reviews guidelines with other nurses. Which of the following statements by the nurses would indicate a correct understanding of the teaching?",
        "options": {
            "A": "The nurse should wear a surgical mask when transporting a client with active pulmonary tuberculosis (TB).",
            "B": "Disposable utensils must be provided for a client infected with hepatitis B.",
            "C": "A surgical mask should be worn when working within three feet of the client infected with Neisseria meningitidis.",
            "D": "A surgical gown should be applied when entering a client's room with bacterial pneumonia."
        },
        "correctAnswer": "C",
        "explanation": "    ",
        "difficulty": 2
    },
    {
        "question": "TThe infection control nurse is reviewing guidelines with staff about appropriate isolation precautions for various communicable diseases. Which of the following statements by a nurse indicates a correct understanding of infection control?",
        "options": {
            "A": "A client with Varicella (chickenpox) who still has new vesicles can be managed on droplet precautions if most lesions are covered by clothing.",
            "B": " A client with disseminated herpes zoster should be placed in a negative-pressure room, and staff must follow both airborne and contact precautions.",
            "C": "A client with Neisseria meningitidis meningitis needs droplet precautions for 48 hours and should remain in a negative-pressure room until cultures are negative.",
            "D": "A client with seasonal influenza requires contact precautions and an N95 respirator for staff if the client has a persistent cough."
        },
        "correctAnswer": "B",
        "explanation": "    ",
        "difficulty": 3
    },
    {
        "question": "The nurse in the emergency department (ED) is caring for a child with erythema infectiosum (Fifth disease). Which transmission-based precautions should the nurse implement?",
        "options": {
            "A": "Standard.",
            "B": "Droplet.",
            "C": "Contact.",
            "D": "Airborne."
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 1
    },
    {
        "question": "The occupational health nurse is conducting an in-service on reducing back injuries. It would be correct for the nurse to identify that the most common location of the injury is the",
        "options": {
            "A": "cervical spine.",
            "B": "lumbar spine.",
            "C": "thoracic spine.",
            "D": "pelvis."
        },
        "correctAnswer": "B",
        "explanation": "    ",
        "difficulty": 1
    },
    {
        "question": "The nurse working with geriatric clients understands that falls are more likely to occur in elderly clients who are:",
        "options": {
            "A": "Living on disability insurance.",
            "B": "In their 80s.",
            "C": "Living in their own home.",
            "D": "Hospitalized."
        },
        "correctAnswer": "D",
        "explanation": "    ",
        "difficulty": 2
    },
    {
        "question": "A 16-year old male arrives at the trauma bay after suffering from a head injury. He is postictal and is being intubated to protect his airway. After obtaining IV access, the doctor orders a diuretic. Based on the history provided, what diuretic will the doctor order?",
        "options": {
            "A": "Mannitol.",
            "B": "Hydrochlorothiazide.",
            "C": "Spironolactone.",
            "D": "Furosemide."
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 2
    },
    {
        "question": "The nurse is caring for a child with varicella zoster. The nurse should implement which transmission-based precautions?",
        "options": {
            "A": "Droplet precautions.",
            "B": "Airborne and contact precautions.",
            "C": "Contact and droplet precautions.",
            "D": "Contact precautions."
        },
        "correctAnswer": "B",
        "explanation": "    ",
        "difficulty": 1
    },
    {
        "question": "The nurse has attended a continuing education conference about infection control precautions. It would indicate a correct understanding of the education if the nurse is observed",
        "options": {
            "A": "using dedicated client-care equipment for a client with Clostridium difficile.",
            "B": "wearing a particulate respirator mask (N95) while caring for a client with epiglottitis, due to Haemophilus influenzae type b.",
            "C": "placing a surgical mask on a client being transported with radiology who has infectious mononucleosis.",
            "D": "keeping the door closed for a client with cryptococcosis meningitis.."
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 1
    },
    {
        "question": "When educating a patient newly prescribed with quetiapine, the nurse should include which of the following instructions?",
        "options": {
            "A": "Report if xerostomia (dry mouth) is noted",
            "B": "Report signs of weight gain",
            "C": "Have a weekly WBC count for the first 6 months of taking the medication",
            "D": "Report signs of headache and dizziness"
        },
        "correctAnswer": "B",
        "explanation": "   ",
        "difficulty": 3
    },
    {
        "question": "A nurse is reviewing the healthcare provider's orders for a patient admitted with diabetic ketoacidosis (DKA). Which order should the nurse clarify?",
        "options": {
            "A": "0.9% NaCl at 1000 mL/hr",
            "B": "Regular insulin continuous infusion",
            "C": "Sodium bicarbonate infusion",
            "D": "Spironolactone bolus"
        },
        "correctAnswer": "D",
        "explanation": "Answer Explanation:\n\n0.9% NaCl at 1000 mL/hr: This is a typical initial fluid resuscitation order for a patient with DKA to address dehydration.\nRegular insulin continuous infusion: This is the standard treatment to reduce blood glucose levels in DKA.\nSodium bicarbonate infusion: This is generally not recommended for DKA treatment unless the patient has severe acidosis (pH < 6.9), as it can cause complications.\nSpironolactone bolus: This medication is a potassium-sparing diuretic and is not typically used in the acute management of DKA.",
        "difficulty": 3
    },
           {
        "question": "You are assigned to the following patients. Which patient should you assess first?",
        "options": {
            "A": " A 40-year-old patient with COPD experiencing new onset of thick white secretions and increased shortness of breath",
            "B": " A 12-year-old patient with Wilms tumor presenting with abdominal swelling and a blood pressure of 140/90",
            "C": "A patient with a nasogastric tube reporting nausea and vomiting",
            "D": " A 65-year-old patient with diabetes complaining of dizziness and blurred vision"
        },
        "correctAnswer": "A",
        "explanation": "   ",
        "difficulty": 3
    },
       {
        "question": "A nurse is reviewing vaccination eligibility for the varicella vaccine. Which client is appropriate to receive the varicella vaccine?",
        "options": {
            "A": "A client with a documented allergy to gelatin.",
            "B": "A client with a diagnosis of lymphoma currently undergoing chemotherapy.",
            "C": "A client who is immunocompromised due to long-term corticosteroid therapy.",
            "D": "A client with a history of pulmonary tuberculosis."
        },
        "correctAnswer": "D",
        "explanation": "   ",
        "difficulty": 3
    },
    {
        "question": "The nurse is performing triage for the following clients. The nurse should assign a private room first to a client with",
        "options": {
            "A": "Leg rash after exposure to poison ivy",
            "B": "Chickenpox on day 14 with crusted lesions",
            "C": "Patient with impetigo on the 3rd day of antibiotic treatment ",
            "D": "Suspected pertussis "
        },
        "correctAnswer": "D",
        "explanation": "   ",
        "difficulty": 3
    },
        {
        "question": "The nurse is positioning clients before and after procedures. Which of the following would require follow-up? ",
        "options": {
            "A": "Fowler position after a cardiac catheterization via femoral artery",
            "B": "Right side lying after a liver biopsy ",
            "C": "   Sims position before a soap enema",
            "D": "Supine position after a lumbar puncture"
        },
        "correctAnswer": "A",
        "explanation": "   ",
        "difficulty": 2
    },
            {
        "question": " A patient with Parkinson\u2019s disease is prescribed pramipexole. Which of the following statements by the patient indicates a need for further teaching?\n",
        "options": {
            "A": "\"I will take my medication exactly as prescribed to help manage my symptoms.\"",
            "B": "\"I should rise slowly from a seated position to avoid feeling dizzy.\"",
            "C": "\"I can stop taking my medication if I feel fine after a few weeks.\"",
            "D": "\"I should avoid driving if I feel drowsy or if I have sudden sleep episodes.\""
        },
        "correctAnswer": "C",
        "explanation": "Pramipexole should not be discontinued abruptly as this can worsen symptoms or lead to withdrawal effects. Patients should always consult their healthcare provider before making any changes to their medication regimen.",
        "difficulty": 3
    },
    {
        "question": "A nurse in a clinic is returning phone calls from patients. Which patient should the nurse call back first?",
        "options": {
            "A": "A patient with anorexia nervosa reporting muscle weakness.",
            "B": " A patient with bipolar I disorder requesting a refill of sertraline.",
            "C": "A patient with diabetes reporting a blood sugar of 250 mg/dL.",
            "D": "A patient with a mild headache requesting advice on over-the-counter pain medication."
        },
        "correctAnswer": "A",
        "explanation": "   ",
        "difficulty": 3
    },
    {
        "question": "A nurse is caring for a patient with a stage 2 pressure ulcer. Which type of dressing is most appropriate to promote healing for this type of wound?",
        "options": {
            "A": "Hydrocolloid dressing",
            "B": "Petrolatum gauze",
            "C": "Dry sterile gauze",
            "D": "Transparent film dressing"
        },
        "correctAnswer": "A",
        "explanation": "    ",
        "difficulty": 2
    },
        {
        "question": "A patient has been diagnosed with a Vitamin D deficiency. What would you advise them to do?",
        "options": {
            "A": "Avoid sunlight",
            "B": "Eat grilled mackerel",
            "C": "Drink 450 ml of fruit juice daily",
            "D": "Drink a lot of milk"
        },
        "correctAnswer": "B",
        "explanation": "  ",
        "difficulty": 1
    },
    {
        "question": "You are a nurse returning phone calls. Which patient should you prioritize calling back first?\n",
        "options": {
            "A": " A patient diagnosed with TIA 6 months ago who developed left-sided weakness this morning",
            "B": "A patient with COPD walking in the hallway using pursed-lip breathing",
            "C": "A patient diagnosed with MI 4 months ago who experienced angina after climbing 2 flights of stairs but was relieved by rest",
            "D": "A patient with a history of hypertension reporting a severe headache unrelieved by medication"
        },
        "correctAnswer": "A",
        "explanation": "   ",
        "difficulty": 3
    },
       {
        "question": "A nurse is providing discharge teaching to a client who underwent a laparoscopic cholecystectomy. Which statement by the client indicates a correct understanding of the post-operative expectations?",
        "options": {
            "A": "I can be discharged the same day after surgery if there are no complications.",
            "B": "I will have sutures and a drainage bag in place for several weeks after surgery.",
            "C": "I will need to take at least 4 weeks off work before resuming any activities.",
            "D": "I should avoid showering until my follow-up appointment to prevent infection."
        },
        "correctAnswer": "A",
        "explanation": "   ",
        "difficulty": 3
    },
       {
        "question": "You are assigned to the following patients. Which patient should you assess first?",
        "options": {
            "A": " A 40-year-old patient with COPD experiencing new onset of thick white secretions and increased shortness of breath",
            "B": "A 12-year-old patient with Wilms tumor presenting with abdominal swelling and a blood pressure of 140/90",
            "C": "A patient with a nasogastric tube reporting nausea and vomiting",
            "D": "A 65-year-old patient with diabetes complaining of dizziness and blurred vision"
        },
        "correctAnswer": "A",
        "explanation": "   ",
        "difficulty": 3
    },
        {
        "question": "The nurse is reinforcing discharge instructions with a client following a partial gastrectomy.\u00a0 Which of the following instructions should the nurse include to prevent dumping syndrome?\u00a0 Select all that apply.",
        "options": {
            "A": "Add high-protein foods to diet",
            "B": "Consume high-carbohydrate meals",
            "C": "Eat small, frequent meals",
            "D": "Increase intake of fluids with meals",
            "E": "Lie down after eating"
        },
        "correctAnswer": [
            "A",
            "C",
            "E"
        ],
        "explanation": "To prevent dumping syndrome following a partial gastrectomy, clients should consume high-protein foods, eat small, frequent meals, and lie down after eating. They should avoid high-carbohydrate meals and refrain from increasing fluid intake with meals to prevent rapid gastric emptying.",
        "difficulty": 4
    },
        {
        "question": "Which statements made by the client demonstrate a correct understanding of the home care of an ascending colostomy?\u00a0 Select all that apply.",
        "options": {
            "A": "\"I will clarify with my health care provider before taking enteric-coated medications.\"",
            "B": "\"I will irrigate the colostomy to promote regular bowel movements.\"",
            "C": "\"I will limit eating foods such as broccoli and cauliflower to reduce odor.\"",
            "D": "\"I will restrict my fluid intake to 2,000 milliliters of fluid a day.\"",
            "E": "\"I will wait for the pouch to become completely full before emptying the contents.\""
        },
        "correctAnswer": [
            "A",
            "C"
        ],
        "explanation": "Statements that demonstrate a correct understanding of home care for an ascending colostomy include clarifying with the healthcare provider before taking enteric-coated medications and limiting the intake of foods such as broccoli and cauliflower to reduce odor. Enteric-coated medications may not be absorbed properly due to the altered gastrointestinal tract. Foods that cause excess gas and odor should be avoided. Irrigation is not needed for ascending colostomies because the stool is semiliquid. Fluid intake should be increased to at least 3,000 mL/day to prevent dehydration, and the pouch should be emptied when it is one-third full to prevent leaks.",
        "difficulty": 4
    },
    {
        "question": "The nurse is assessing a client with hepatic encephalopathy. The nurse notes the client is lethargic and confused. Which of the following actions should the nurse take? Select all that apply.",
        "options": {
            "A": "Compare the current assessment findings with previous assessment findings.",
            "B": "Request an order to check the client's serum ammonia level.",
            "C": "Encourage the client to ambulate in the hallway.",
            "D": "Hold the client's scheduled dose of lactulose.",
            "E": "Check the client for flapping hand tremors."
        },
        "correctAnswer": [
            "A",
            "B",
            "E"
        ],
        "explanation": "For a client with hepatic encephalopathy who is lethargic and confused, the nurse should compare current assessment findings with previous ones to identify changes in mental status, request an order to check the client's serum ammonia level, and check for flapping hand tremors (asterixis). Encouraging ambulation is not appropriate due to the risk of falls, and holding the scheduled dose of lactulose could worsen the condition, as lactulose helps reduce serum ammonia levels.",
        "difficulty": 5
    },
    {
        "question": "The nurse is talking with a client who is scheduled for a screening colonoscopy. The client asks, \"What should I know about this procedure?\" Which of the following information should the nurse include? Select all that apply.",
        "options": {
            "A": "\"The procedure is not painful, and you will be sedated.\"",
            "B": "\"Your abdomen should feel firm and distended after the procedure.\"",
            "C": "\"You will need to avoid consuming red liquids prior to the procedure.\"",
            "D": "\"Colonoscopies are performed to screen for colon cancer and colon polyps.\"",
            "E": "\"You will be given laxatives before the procedure to completely empty your colon.\""
        },
        "correctAnswer": [
            "A",
            "C",
            "D",
            "E"
        ],
        "explanation": "For a client scheduled for a screening colonoscopy, the nurse should explain that the procedure is not painful and the client will be sedated, red liquids should be avoided prior to the procedure, the procedure screens for colon cancer and colon polyps, and laxatives will be given to completely empty the colon. The client should be informed to notify the healthcare provider if the abdomen feels firm and distended after the procedure, as this could indicate colonic perforation, a serious complication.",
        "difficulty": 4
    },
           {
        "question": "The nurse is reviewing lifestyle and nutritional strategies to help reduce symptoms in a client with newly diagnosed gastroesophageal reflux disease.\u00a0 Which strategies should the nurse include?\u00a0 Select all that apply.",
        "options": {
            "A": "Choose foods that are low in fat",
            "B": "Do not consume any foods containing dairy",
            "C": "Eat three large meals a day and minimize snacking",
            "D": "Limit or eliminate the use of alcohol and tobacco",
            "E": "Try to avoid caffeine, chocolate, and peppermint"
        },
        "correctAnswer": [
            "A",
            "D",
            "E"
        ],
        "explanation": "For clients with gastroesophageal reflux disease (GERD), the nurse should include the following strategies: choose low-fat foods, limit or eliminate alcohol and tobacco, and avoid caffeine, chocolate, and peppermint. These measures help reduce reflux by minimizing factors that decrease the tone of the lower esophageal sphincter, delay gastric emptying, or increase gastric pressure. Clients should not avoid all dairy but opt for low-fat or nonfat products and should eat small, frequent meals instead of three large ones.",
        "difficulty": 4
    },
    {
        "question": "A nurse is educating the parents of a child who experienced a febrile seizure. Which statements indicate a correct understanding of febrile seizures? Select all that apply.",
        "options": {
            "A": "Antipyretics cannot prevent febrile seizures from occurring.",
            "B": "Simple and complex febrile seizures that are concurrently happening can lead to Tourette syndrome.",
            "C": "Febrile seizures indicate the presence of an underlying neurological condition.",
            "D": "All children with febrile seizures require daily antiseizure medication to prevent future episodes.",
            "E": "Febrile seizures are more likely to cause permanent brain damage if they occur more than once."
        },
        "correctAnswer": [
            "A"
        ],
        "explanation": "  ",
        "difficulty": 4
    },
    {
        "question": "The nurse is assessing a client with suspected hepatitis. Which of the following questions would be important for the nurse to ask the client? Select all that apply.",
        "options": {
            "A": "\"Do you have black, tarry stools?\"",
            "B": "\"Do you take any over-the-counter medications?\"",
            "C": "\"How many alcoholic beverages do you consume per week?\"",
            "D": "\"Have you recently received the pneumococcal vaccine?\"",
            "E": "\"Do you use injectable recreational substances?\""
        },
        "correctAnswer": [
            "B",
            "C",
	    "E"
        ],
        "explanation": "To assess a client with suspected hepatitis, the nurse should inquire about over-the-counter medication use, alcohol consumption, and injectable recreational substance use. These questions help identify potential hepatotoxic medications, alcohol use disorder, and risk factors for viral hepatitis transmission. Questions about black, tarry stools and recent pneumococcal vaccination are less relevant for diagnosing hepatitis, as melena is associated with gastrointestinal bleeding and the pneumococcal vaccine is not linked to hepatotoxicity.",
        "difficulty": 4
    },
    {
        "question": "The nurse is caring for a client with acute pancreatitis who has severe nausea, frequent vomiting, epigastric pain, and tachycardia.\u00a0 Which of the following interventions should the nurse anticipate for this client?\u00a0 Select all that apply.",
        "options": {
            "A": "Administer IV fluids",
            "B": "Administer IV hydromorphone for pain",
            "C": "Insert a nasogastric tube for nasogastric suction",
            "D": "Maintain the client in a supine position with the head of bed flat",
            "E": "Provide small, frequent, high-carbohydrate, high-calorie meals"
        },
        "correctAnswer": [
            "A",
            "B",
            "C"
        ],
        "explanation": "For a client with acute pancreatitis experiencing severe nausea, frequent vomiting, epigastric pain, and tachycardia, the nurse should anticipate administering IV fluids to prevent hypovolemic shock, administering IV hydromorphone for pain management, and inserting a nasogastric tube for gastric suction to reduce nausea and pancreatic stimulation. The client should be kept NPO to inhibit pancreatic enzyme secretion, and the best position to relieve pain is side-lying with the head elevated to 45 degrees, not supine with the head of the bed flat.",
        "difficulty": 5
    },
    {
        "question": "The nurse is caring for a client with ascites who is scheduled for a paracentesis. Which of the following actions should the nurse take? Select all that apply.",
        "options": {
            "A": "Explain the risks and benefits of the procedure and obtain informed consent.",
            "B": "Encourage the client to ambulate immediately after the procedure.",
            "C": "Request that the client empty the bladder before the procedure.",
            "D": "Obtain baseline vital signs, abdominal girth, and weight.",
            "E": "Initiate NPO status 12 hours prior to the procedure."
        },
        "correctAnswer": [
            "C",
            "D"
        ],
        "explanation": "Before a paracentesis, the nurse should request that the client empty their bladder to prevent puncturing it and obtain baseline vital signs, abdominal girth, and weight. The healthcare provider is responsible for explaining the risks and benefits and obtaining informed consent. Clients should not ambulate immediately after the procedure due to the risk of hypovolemia and syncope from fluid shifts, and NPO status is not required for this procedure.",
        "difficulty": 4
    },
        {
        "question": "A nurse is evaluating the teaching of weight reduction strategies to a client with obesity.\u00a0 Which of the following statements indicate that the client understands the teaching?\u00a0 Select all that apply.",
        "options": {
            "A": "\"Fruit juice is a good substitute for soda.\"",
            "B": "\"I will aim to lose 1-2 lb (0.45-0.91 kg) per week.\"",
            "C": "\"I will keep healthy snacks on hand in case I get hungry.\"",
            "D": "\"I will skip breakfast to save calories for later in the day.\"",
            "E": "\"I will take the stairs instead of the elevator.\""
        },
        "correctAnswer": [
            "B",
            "C",
            "E"
        ],
        "explanation": "A client understands weight reduction strategies if they aim to lose 1-2 lb per week, keep healthy snacks on hand, and take the stairs instead of the elevator. These practices support gradual weight loss, availability of nutritious options, and increased physical activity. Fruit juice is not a good substitute for soda due to its high sugar content, and skipping meals can lead to overeating later, so these are not recommended strategies.",
        "difficulty": 5
    },
];

document.getElementById('exam-form').addEventListener('submit', function(event) {
    event.preventDefault();
    startExam();
});

let currentDifficulty = 2;
let correctAnswers = 0;
let totalQuestions = 0;
let difficultyHistory = [];
let totalScore = 0;
let timer;
let totalTime = 0;
let currentQuestionData;

const conversionTable = {
    2: [1, 1.25, 1.5, 1.75, 2],
    3: [2, 2.25, 2.5, 2.75, 3],
    4: [3, 3.25, 3.5, 3.75, 4],
    5: [4, 4.25, 4.5, 4.75, 5]
};

function startExam() {
    const firstName = document.getElementById('first-name').value;
    const lastName = document.getElementById('last-name').value;
    document.getElementById('test-taker-name').innerText = `${firstName} ${lastName}`;
    document.getElementById('exam-form').style.display = 'none';
    document.getElementById('test-taker').style.display = 'block';
    document.getElementById('timer').style.display = 'block';
    document.getElementById('difficulty').style.display = 'block';
    document.getElementById('quiz-container').style.display = 'block';
    startTimer();
    showQuestion();
}

function startTimer() {
    timer = setInterval(() => {
        totalTime++;
        const minutes = String(Math.floor(totalTime / 60)).padStart(2, '0');
        const seconds = String(totalTime % 60).padStart(2, '0');
        document.getElementById('timer').innerText = `Time: ${minutes}:${seconds}`;
    }, 1000);
}

function showQuestion() {
    if (totalQuestions >= 10) {
        const averageDifficulty = totalScore / totalQuestions;
        if (averageDifficulty >= 3.5) {
            return endExam('Pass');
        } else if (averageDifficulty < 2.8) {
            return endExam('Fail');
        }
    }
    
    if (totalQuestions >= 10) {
        return endExam();
    }

    // Filter questions based on current difficulty
    const availableQuestions = questions.filter(q => q.difficulty === currentDifficulty);
    // Randomly select a question from the filtered list
    currentQuestionData = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
    
    document.getElementById('difficulty').innerText = `Difficulty Level: ${currentDifficulty}`;
    document.getElementById('question-number').innerText = `Question ${totalQuestions + 1}`;
    document.getElementById('question-text').innerText = currentQuestionData.question;
    const optionsContainer = document.getElementById('options-container');
    optionsContainer.innerHTML = '';
    const isSelectAllThatApply = Array.isArray(currentQuestionData.correctAnswer);
    for (const [key, value] of Object.entries(currentQuestionData.options)) {
        const option = document.createElement('div');
        if (isSelectAllThatApply) {
            option.innerHTML = `<input type="checkbox" id="${key}" name="option" value="${key}">
                                <label for="${key}">${key}: ${value}</label>`;
        } else {
            option.innerHTML = `<input type="radio" id="${key}" name="option" value="${key}">
                                <label for="${key}">${key}: ${value}</label>`;
        }
        optionsContainer.appendChild(option);
    }
    document.getElementById('feedback-container').style.display = 'none';
    document.getElementById('submit-btn').style.display = 'block';
    document.getElementById('next-btn').style.display = 'none';
}

document.getElementById('submit-btn').addEventListener('click', submitAnswer);
document.getElementById('next-btn').addEventListener('click', nextQuestion);

function submitAnswer() {
    console.log('Submit button clicked');
    const selectedOptions = Array.from(document.querySelectorAll('input[name="option"]:checked')).map(opt => opt.value);
    if (selectedOptions.length === 0) {
        alert('Please select at least one option!');
        return;
    }
    
    const { isCorrect, status, partialScore } = checkAnswer(selectedOptions, currentQuestionData.correctAnswer);

    updateDifficulty(isCorrect);
    updateScore(partialScore);
    difficultyHistory.push(currentDifficulty);

    document.getElementById('feedback-container').innerText = `${status}: ${currentQuestionData.explanation}`;
    document.getElementById('feedback-container').style.display = 'block';
    document.getElementById('submit-btn').style.display = 'none';
    document.getElementById('next-btn').style.display = 'block';
}

function checkAnswer(selectedOptions, correctAnswer) {
    console.log('Checking answer...');
    if (Array.isArray(correctAnswer)) {
        const correctCount = correctAnswer.filter(answer => selectedOptions.includes(answer)).length;
        const wrongCount = selectedOptions.filter(option => !correctAnswer.includes(option)).length;
        const totalCorrect = correctAnswer.length;
        let scorePercentage = (correctCount - wrongCount) / totalCorrect;

        if (scorePercentage < 0) {
            scorePercentage = 0;
        }

        const scoreIndex = Math.round(scorePercentage * 4);
        return { 
            isCorrect: scorePercentage >= 1, 
            status: scorePercentage >= 1 ? "Correct" : scorePercentage > 0 ? "Partially Correct" : "Incorrect", 
            partialScore: conversionTable[currentDifficulty][scoreIndex] 
        };
    } else {
        const isCorrect = selectedOptions.includes(correctAnswer);
        const partialScore = isCorrect ? currentDifficulty : Math.max(1, currentDifficulty - 1);
        return { 
            isCorrect: isCorrect, 
            status: isCorrect ? "Correct" : "Incorrect", 
            partialScore: partialScore 
        };
    }
}

function updateDifficulty(isCorrect) {
    if (isCorrect) {
        if (currentDifficulty < 5) currentDifficulty++;
    } else {
        if (currentDifficulty > 1) currentDifficulty--;
    }
}

function updateScore(partialScore) {
    totalScore += partialScore;
    totalQuestions++;
    console.log(`Total Score: ${totalScore}, Total Questions: ${totalQuestions}`);
}

function nextQuestion() {
    showQuestion();
}

function endExam(result) {
    clearInterval(timer);
    document.getElementById('quiz-container').style.display = 'none';
    document.getElementById('result-container').style.display = 'block';

    const averageDifficulty = totalScore / totalQuestions;
    console.log(`Final Total Score: ${totalScore}, Total Questions: ${totalQuestions}, Average Difficulty: ${averageDifficulty.toFixed(2)}`);

    if (!result) {
        result = averageDifficulty >= 2.6 ? 'Pass' : averageDifficulty < 2.5 ? 'Fail' : 'Continue';
    }

    if (result === 'Continue') {
        return; // Continue the test if between 2.5 and 2.59
    }

    document.getElementById('summary').innerText = result === 'Pass' ? 'Congratulations! USRN! You Passed!HAPPY VALENTINES DAY SA MGA MARUPOK SA MGA INIWAN SA MGA SINGLE, ILANG ORAS NALANG FEB 15 NA!! see you sa TOPRANK INTERNATIONAL.' : 'Unfortunately, you failed. Study hard to improve! HAPPY VALENTINES DAY! SA MGA MARUPOK,INIWAN NG WLANG PAALAM,AT SINGLE, AT SA MGA KABIT. ILANG ORAS NALANG FEB 15 NA!! see you sa TOPRANK INTERNATIONAL.';
    document.getElementById('final-score').innerText = `Average Difficulty: ${averageDifficulty.toFixed(2)}`;

    // Create line graph
    const ctx = document.getElementById('progressChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({ length: difficultyHistory.length }, (_, i) => i + 1),
            datasets: [{
                label: 'Difficulty Level',
                data: difficultyHistory,
                borderColor: '#007bff',
                fill: false
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5
                }
            }
        }
    });
}